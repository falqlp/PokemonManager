<div class="battle__right-part">
  <div class="battle__right-part__top">
    <h3 class="battle__right-part__top__title">
      <pm-trainer-name
        class="battle__right-part__top__player"
        [trainer]="player" />
      <span> VS</span>
      <pm-trainer-name
        class="battle__right-part__top__opponent"
        [trainer]="opponent" />
    </h3>
    <div class="battle__right-part__actions">
      @if(!loopMode){
      <button [disabled]="defeat" color="warn" mat-icon-button (click)="next()">
        <mat-icon>play_arrow</mat-icon>
      </button>
      } @if(loopMode){
      <button mat-icon-button (click)="pause()">
        <mat-icon>pause</mat-icon>
      </button>
      } @else {
      <button mat-icon-button (click)="loop()">
        <mat-icon>repeat</mat-icon>
      </button>
      }
    </div>
  </div>
  <div class="battle__right-part__move-order">
    <span>{{ 'NEXT_MOVES' | translate }} :</span>
    @for (pokemon of battleOrder; track pokemon){
    <mat-card
      class="battle__right-part__move-order__pokemon"
      [ngClass]="
        pokemon.trainerId === opponent._id
          ? 'battle__right-part__move-order__pokemon--opponent'
          : ''
      ">
      {{ pokemon.nickname ?? pokemon.basePokemon.name | translate }}
      {{ 'LVL' | translate }}: {{ pokemon.level }}
    </mat-card>
    }
  </div>
  <div #messages class="battle__right-part__message">
    @for (roundMessage of battleMessage; track roundMessage){ @for (message of
    roundMessage; track message){
    <div>
      {{ message }}
    </div>
    }
    <mat-divider class="battle__right-part__message__separator" />
    }
  </div>
</div>
<div class="battle__scene">
  <img class="battle__scene__background" src="assets/battleback/City.png" />
  <div class="battle__scene__opponent">
    @for (opponentPokemon of opponent.pokemons; track opponentPokemon._id){
    <div
      class="battle__scene__opponent__pokemon"
      [ngClass]="
        'battle__scene__opponent__pokemon--' + opponent.pokemons.length
      ">
      <div class="battle__scene__opponent__pokemon__info">
        <span
          >{{
            opponentPokemon.nickname ?? opponentPokemon.basePokemon.name
              | translate
          }}
        </span>
        <span>
          {{ 'LVL' | translate }}: {{ opponentPokemon.level }}
          <pm-battle-daily-form [dailyForm]="opponentPokemon.dailyForm" />
        </span>
        <progress-bar
          [currentProgress]="opponentPokemon.currentHp"
          [displayHp]="false"
          [max]="opponentPokemon.stats['hp']"
          [min]="0"
          [style]="'hp'"></progress-bar>
      </div>
      <div class="battle__scene__opponent__pokemon__image">
        <img
          class="battle__scene__opponent__pokemon__image__ground"
          [ngClass]="
            'battle__scene__opponent__pokemon__image__ground--' +
            opponent.pokemons.length
          "
          src="assets/battleback/ground_city.PNG" />
        <app-display-pokemon-image
          [ngClass]="[
            opponentPokemon.moving
              ? 'battle__scene__opponent__pokemon__image__pokemon--moving'
              : '',
            'battle__scene__opponent__pokemon__image__pokemon--' +
              opponent.pokemons.length
          ]"
          [pokemon]="opponentPokemon"
          type="thumbnails" />
        @if (opponentPokemon.animation) {
        <img
          class="battle__scene__opponent__pokemon__image__animation"
          src="assets/move_animation/{{ opponentPokemon.animation }}.gif"
          [alt]="opponentPokemon.animation" />
        }
      </div>
    </div>
    }
  </div>
  <div class="battle__scene__player">
    @for (playerPokemon of player.pokemons; track playerPokemon._id){
    <div
      class="battle__scene__player__pokemon"
      [ngClass]="'battle__scene__player__pokemon--' + player.pokemons.length">
      <div class="battle__scene__player__pokemon__image">
        <img
          class="battle__scene__player__pokemon__image__ground"
          [ngClass]="
            'battle__scene__player__pokemon__image__ground--' +
            opponent.pokemons.length
          "
          src="assets/battleback/ground_city.PNG" />
        <app-display-pokemon-image
          class="battle__scene__player__pokemon__image__pokemon"
          [ngClass]="[
            playerPokemon.moving
              ? 'battle__scene__player__pokemon__image__pokemon--moving'
              : '',
            'battle__scene__player__pokemon__image__pokemon--' +
              player.pokemons.length
          ]"
          [pokemon]="playerPokemon"
          type="back" />
        @if (playerPokemon.animation) {
        <img
          class="battle__scene__player__pokemon__image__animation"
          src="assets/move_animation/{{ playerPokemon.animation }}.gif"
          [alt]="playerPokemon.animation" />
        }
      </div>
      <div class="battle__scene__player__pokemon__info">
        <span
          >{{
            playerPokemon.nickname ?? playerPokemon.basePokemon.name | translate
          }}
        </span>
        <div class="flex">
          {{ 'LVL' | translate }}: {{ playerPokemon.level }}
          <pm-battle-daily-form [dailyForm]="playerPokemon.dailyForm" />
        </div>
        <progress-bar
          [currentProgress]="playerPokemon.currentHp"
          [displayHp]="true"
          [max]="playerPokemon.stats['hp']"
          [min]="0"
          [style]="'hp'"></progress-bar>
      </div>
    </div>
    }
  </div>
</div>
